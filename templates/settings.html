{% extends "base.html" %}

{% block content %}
    <form action="{{ SITE_ROOT }}settings" method="post" id="settings_form">
        {% csrf_token %}
        {{ form.as_p }}
        <input type="submit" value="Update" class="button" />
    </form>
    
    <div id="map_canvas"></div>
    <div id="test"></div>
{% endblock %}

{% block js_extra_imports %}
    {{ block.super }}
    <script src="http://malsup.github.com/jquery.form.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.18/jquery-ui.min.js"></script>
 
    <script type="text/javascript">
    // Set up ajax requests with Django CSRF
    $.ajaxSetup({
       data: { csrfmiddlewaretoken: '{{ csrf_token }}' },
    });
    
    $(document).ready(function() {  
        var options = { 
            success: showResponse  // post-submit callback 
        };     
        
        $('#settings_form').submit(function(event) {
            event.preventDefault();
            $(this).ajaxSubmit(options);
            
            // return false to prevent normal browser submit and page navigation 
            return false; 
        });
    });
    
    function showResponse(responseText, statusText, xhr, $form) { 
        $("#flash").html(responseText.message);
        $("#flash").effect("highlight", {}, 3000);
    } 
    </script>
{% endblock %}